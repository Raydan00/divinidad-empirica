<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sangre de Divinidad Empírica</title>
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#8b0000">
</head>
<body>
<header>
    <h1>Sangre de Divinidad Empírica</h1>
</header>

<nav id="nav-chapters"></nav>

<main>
    <section id="chapter-content">
        <h2 id="chapter-title">Cargando...</h2>
        <p id="chapter-text">Por favor espera.</p>
        <audio id="chapter-audio" controls>
            <source id="audio-src" src="" type="audio/mpeg">
        </audio>
    </section>
</main>

<script>
// Registrar service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker registrado', reg))
      .catch(err => console.log('Service Worker fallo', err));
  });
}

let chapters = [];
let currentChapter = 0;

// Cargar capítulos desde chapters.json
fetch('chapters.json')
    .then(resp => resp.json())
    .then(data => {
        chapters = data;
        createButtons();
        showChapter(0); // mostrar primer capítulo
    })
    .catch(err => {
        document.getElementById('chapter-text').textContent = "No se pudieron cargar los capítulos.";
    });

function createButtons() {
    const nav = document.getElementById('nav-chapters');
    chapters.forEach((chap, index) => {
        const btn = document.createElement('button');
        btn.textContent = chap.title;
        btn.onclick = () => showChapter(index);
        nav.appendChild(btn);
    });
}

function showChapter(index) {
    if(index < 0 || index >= chapters.length) return;
    currentChapter = index;

    const chap = chapters[index];
    document.getElementById('chapter-title').textContent = chap.title;
    document.getElementById('audio-src').src = chap.audio;
    document.getElementById('chapter-audio').load();

    fetch(chap.text)
        .then(resp => resp.text())
        .then(text => {
            document.getElementById('chapter-text').textContent = text;
        })
        .catch(err => {
            document.getElementById('chapter-text').textContent = "Capítulo no disponible.";
        });
}
</script>
</body>
</html>
