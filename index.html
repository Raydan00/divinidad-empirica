<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sangre de Divinidad Empírica</title>
<link rel="stylesheet" href="style.css">
<meta name="theme-color" content="#8b0000">
</head>
<body>
<header>
    <h1>Sangre de Divinidad Empírica</h1>
</header>

<nav id="nav-chapters"></nav>

<main>
    <section id="chapter-content">
        <h2 id="chapter-title">Cargando...</h2>

        <audio id="chapter-audio" controls>
            <source id="audio-src" src="" type="audio/mpeg">
            Tu navegador no soporta audio.
        </audio>

        <p id="chapter-text">Por favor espera.</p>
    </section>
</main>

<script>
let chapters = [];
let currentChapter = 0;

// Cargar lista de capítulos
fetch('chapters.json')
    .then(resp => resp.json())
    .then(data => {
        chapters = data;
        createButtons();
        showChapter(0);
    })
    .catch(err => {
        console.error("ERROR cargando chapters.json:", err);
        document.getElementById('chapter-text').textContent = "No se pudieron cargar los capítulos.";
    });

// Crear botones
function createButtons() {
    const nav = document.getElementById('nav-chapters');
    chapters.forEach((chap, index) => {
        const btn = document.createElement('button');
        btn.textContent = chap.title;
        btn.onclick = () => showChapter(index);
        nav.appendChild(btn);
    });
}

// Mostrar capítulo
function showChapter(index) {
    if (index < 0 || index >= chapters.length) return;

    currentChapter = index;
    const chap = chapters[index];

    document.getElementById('chapter-title').textContent = chap.title;

    // AUDIO
    const audioSrc = document.getElementById('audio-src');
    audioSrc.src = chap.audio;
    const audio = document.getElementById('chapter-audio');
    audio.load();

    console.log("Intentando cargar audio:", chap.audio);

    // TEXTO
    fetch(chap.text)
        .then(resp => resp.text())
        .then(text => {
            document.getElementById('chapter-text').textContent = text;
        })
        .catch(err => {
            console.error("ERROR cargando capítulo:", err);
            document.getElementById('chapter-text').textContent = "Capítulo no disponible.";
        });
}
</script>
</body>
</html>
